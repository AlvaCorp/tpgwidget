var f7=new Framework7({material:!0,statusbarOverlay:!1,scrollTopOnStatusbarClick:!0,cache:!1,notificationCloseIcon:!1}),$$=Dom7,mainView=f7.addView(".view-main",{});$$(document).on("ajaxStart",function(){f7.showPreloader("Chargement...")}),$$(document).on("ajaxComplete",function(){f7.hidePreloader()}),f7.device.android&&(window.oncontextmenu=function(e){return e.preventDefault(),e.stopPropagation(),!1});var isStandalone=window.matchMedia("(display-mode: standalone)").matches;if(f7.device.android&&!isStandalone){var stopName=$(".center").text(),html='<div class="content-block"><p>Pour installer un raccourci pour l\'arrêt <strong>'+stopName+'</strong> :</p><ul class="tutorial"><li><div class="step-number">1</div><p>Appuyez sur le bouton <strong>Plus <i class="more"></i></strong> tout en haut à droite de l\'écran</p></li><li><div class="step-number">2</div><p>Sélectionnez <strong>Ajouter à l\'écran d\'accueil</strong></p><img src="/resources/img/ath.png" alt="Ajouter à l\'écran d\'accueil"></li></ul></div>';$$(".left").remove(),$$(".center").text("TPGwidget"),$$(".page-content").html(html),$$(".page-index").removeClass("layout-dark")}else $.ajax({url:"/ajax/ajaxprochainsdeparts.php?id="+$$(".page-index").attr("data-page").split("-")[1],cache:!1,success:function(e){$$(".page-content").html(e),$$(".page-index").removeClass("layout-dark")},error:function(){$$(".preloader").addClass("smileyErreur"),$$(".preloader").removeClass("preloader"),$$(".preloader-white").removeClass("preloader-white"),$$(".graym").append("<span>Impossible de se connecter au serveur TPGwidget</span>"),$$(".graym h2").html("Erreur")}}),$$(document).on("pageBeforeAnimation",function(e){function t(e){$("meta[name=theme-color]").remove(),$("head").append('<meta name="theme-color" content="'+e+'">')}f7.closeNotification(".notifications");var a=e.detail.page,o=a.name.split("-");"infotraffic"==o[0]&&$$(".pull-to-refresh-content").on("refresh",function(){$.ajax({url:"/ajax/ajaxperturbations.php",cache:!1,success:function(e){$$("#perturbations-all").html(e),f7.pullToRefreshDone()}})}),t("depart"==o[0]?"#"+o[1]:"vehicule"==o||"itineraire"==o?"#333":"#F60")}),$$(document).on("pageAfterAnimation",function(e){var t=e.detail.page,a=t.name.split("-");"depart"===a[0]&&"left"!=t.from&&$(".page-depart .page-content").animate({scrollTop:$(".current").offset().top-100},500),"depart"===a[0]&&$(".pdata").length&&($$(t.container).find(".page-content").css("padding-bottom","150px"),$(".pdata").length>0&&f7.addNotification({message:$(".pdata").html(),button:!1})),"page"!=a[0]&&"index"!=a[0]||$.ajax({url:"/ajax/ajaxprochainsdeparts.php?id="+a[1],cache:!1,success:function(e){$$(t.container).find(".page-content").html(e),$$(".page-page").removeClass("layout-dark"),$$(".page-index").removeClass("layout-dark")}})}),$$(document).on("click",".show-m",function(){$$(".show-h").removeClass("active"),$$(".show-m").addClass("active"),$$(".h").hide(),$$(".m").show(),$$(".tab-link-highlight").css("transform","translate3d(0%, 0px, 0px)")}),$$(document).on("click",".show-h",function(){$$(".show-m").removeClass("active"),$$(".show-h").addClass("active"),$$(".h").show(),$$(".m").hide(),$$(".tab-link-highlight").css("transform","translate3d(100%, 0px, 0px)")}),window.addEventListener("popstate",function(){history.pushState(null,null,window.location.pathname),mainView.router.back()},!1);f7.onPageInit("arrets",function(){$$.ajax({url:"/arrets/arrets.json",dataType:"json",success:function(e){var t='<li><a href="/ajax/page/{{stopCode}}/{{stopName}}" class="item-link"><div class="item-content"><div class="item-inner"><div class="item-title">{{stopName}}</div></div></div></a></li>';f7.virtualList(".virtual-list",{items:e,template:t,searchAll:function(e,t){for(var a=[],o=0;o<t.length;o++)(t[o].stopCode.toLowerCase().indexOf(e.toLowerCase().trim())>=0||t[o].stopName.toLowerCase().indexOf(e.toLowerCase().trim())>=0)&&a.push(o);return a}})}}),"geolocation"in navigator?($$(".location-message").hide(),$$(".enable-geolocation").show(),$$(".enable-geolocation").on("click",function(){$$(".enable-geolocation").hide(),$$(".location-message").css("display","flex"),navigator.geolocation.getCurrentPosition(function(e){$$.ajax({url:"/arrets/geolocation.json",dataType:"json",data:{latitude:e.coords.latitude,longitude:e.coords.longitude},success:function(e){if(0==e.length)$$(".location-message .item-title").text("Aucun arrêt proche trouvé");else{$$(".location-message").hide();for(var t=0;t<e.length;t++){var a=e[t],o='<li><a href="/ajax/page/'+a.stopCode+"/"+a.stopName+'" class="item-link item-content"><div class="item-media"><i class="icon icon-location"></i></div><div class="item-inner"><div class="item-title">'+a.stopName+"</div></div></a></li>";$$(".arrets-location ul").append(o)}}}})},function(){$$(".location-message .item-title").text("Impossible d'obtenir votre position")})})):$$(".arrets-location").remove(),$$("#arrets-search").on("keyup",function(){""!==$$(this).val().trim()?$$(".arrets-location").hide():$$(".arrets-location").show()})}),f7.onPageInit("itineraire",function(){$$("form.ajax-submit").on("submitted",function(e){mainView.router.load({content:e.detail.data.replace(/SCREENWIDTH/g,screen.width)})}),$$.ajax({url:"/itineraire/stops.json",method:"GET",dataType:"json",success:function(e){function t(t,a){function o(t,a,o){var n=[];if(0===a.length)return void o(e);for(var i=0;i<e.length;i++)e[i].toLowerCase().indexOf(a.toLowerCase())>=0&&n.push(e[i]);o(n)}function n(e,a){$$(".itineraire-"+t).find(".item-after").text(a[0]),$$(".itineraire-"+t).find("input").val(a[0])}f7.autocomplete({openIn:"page",opener:$$(".itineraire-"+t),backOnSelect:!0,source:o,onChange:n,pageTitle:a,backText:"Retour",notFoundText:"Aucun arrêt trouvé",searchbarPlaceholderText:"Rechercher...",searchbarCancelText:"Annuler"})}t("depart","Départ"),t("arrivee","Arrivée")}})}),f7.onPageInit("trajets",function(){new Swiper(".swiper-container",{pagination:".swiper-pagination"})});